var k=Object.defineProperty,q=Object.defineProperties;var O=Object.getOwnPropertyDescriptors;var y=Object.getOwnPropertySymbols;var A=Object.prototype.hasOwnProperty,V=Object.prototype.propertyIsEnumerable;var M=(c,r,e)=>r in c?k(c,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):c[r]=e,o=(c,r)=>{for(var e in r||(r={}))A.call(r,e)&&M(c,e,r[e]);if(y)for(var e of y(r))V.call(r,e)&&M(c,e,r[e]);return c},g=(c,r)=>q(c,O(r));import{j as t,f as I,L as R}from"./main-955.js";import{y as _,u as E}from"./bi.326.431.js";import{c as N,_ as l,e as H}from"./bi.223.0.js";import{a as L,h as P,b as B}from"./bi.864.3.js";import{b as T,T as D}from"./bi.300.11.js";import{T as G}from"./bi.991.663.js";const w=(c,r,e,a,n,b)=>{n(g(o({},a),{fluentCrmList:!0})),N({},"refresh_fluent_crm_lists").then(i=>{i&&i.success?(e(h=>_(h,p=>{p.fluentCrmList=i.data.fluentCrmList,p.fluentCrmTags=i.data.fluentCrmTags})),b({show:!0,msg:l("FluentCRM list refreshed","bit-integrations")})):i&&i.data&&i.data.data||!i.success&&typeof i.data=="string"?b({show:!0,msg:`${l("FluentCRM list refresh failed Cause:","bit-integrations")}${i.data.data||i.data}. ${l("please try again","bit-integrations")}`}):b({show:!0,msg:l("FluentCRM list refresh failed. please try again","bit-integrations")}),n(g(o({},a),{fluentCrmList:!1}))}).catch(()=>n(g(o({},a),{fluentCrmTags:!0})))},$=(c,r,e,a,n,b)=>{n(g(o({},a),{fluentCrmTags:!0})),N({},"refresh_fluent_crm_tags").then(i=>{i&&i.success?(e(h=>_(h,p=>{p.default||(p.default={}),i.data.fluentCrmTags&&(p.fluentCrmTags=i.data.fluentCrmTags)})),b({show:!0,msg:l("FluentCRM Tags refreshed","bit-integrations")})):i&&i.data&&i.data.data||!i.success&&typeof i.data=="string"?b({show:!0,msg:`${l("FluentCRM tags refresh failed Cause:","bit-integrations")}${i.data.data||i.data}. ${l("please try again","bit-integrations")}`}):b({show:!0,msg:l("FluentCRM tags refresh failed. please try again","bit-integrations")}),n(g(o({},a),{fluentCrmTags:!1}))}).catch(()=>n(g(o({},a),{fluentCrmTags:!1})))},U=(c,r,e,a)=>{e(!0),N({},"fluent_crm_headers").then(n=>{n&&n.success?n.data.fluentCrmFlelds?(r(b=>_(b,i=>{i.fluentCrmFlelds=n.data.fluentCrmFlelds,i.field_map=z(i)})),a({show:!0,msg:l("Fluent CRM fields refreshed","bit-integrations")})):a({show:!0,msg:l("No Fluent CRM fields found. Try changing the header row number or try again","bit-integrations")}):a({show:!0,msg:l("Fluent CRM fields refresh failed. please try again","bit-integrations")}),e(!1)}).catch(()=>e(!1))},z=c=>{const{field_map:r}=c,{fluentCrmFlelds:e}=c,n=Object.values(e).filter(h=>h.required).map(h=>({formField:"",fluentCRMField:h.key,required:!0})).filter(h=>!r.find(p=>p.fluentCRMField===h.fluentCRMField)),i=r.filter(h=>h.fluentCRMField||h.formField).map(h=>{const p=e[h.fluentCRMField];return p?g(o({},h),{formField:p.label}):h});return[...n,...i]},C=(c,r,e)=>{const a=o({},r);a.name=c.target.value,e(o({},a))},ee=c=>!((c!=null&&c.field_map?c.field_map.filter(e=>!e.formField&&e.fluentCRMField&&e.required):[]).length>0);function J({fluentCrmConf:c,setFluentCrmConf:r,formFields:e}){var n,b;const a=(i,h)=>{const p=o({},c);h==="exists"&&(i.target.checked?p.actions.skip_if_exists=!0:delete p.actions.skip_if_exists),h==="doubleOpIn"&&(i.target.checked?p.actions.double_opt_in=!0:delete p.actions.double_opt_in),r(o({},p))};return t.jsxs("div",{className:"pos-rel d-flx w-8",children:[t.jsx(T,{checked:((n=c.actions)==null?void 0:n.skip_if_exists)||!1,onChange:i=>a(i,"exists"),className:"wdt-200 mt-4 mr-2",value:"skip_if_exists",title:l("Skip exist Contact","bit-integrations"),subTitle:l("Skip if contact already exist in FluentCRM","bit-integrations")}),t.jsx(T,{checked:((b=c.actions)==null?void 0:b.double_opt_in)||!1,onChange:i=>a(i,"doubleOpIn"),className:"wdt-200 mt-4 mr-2",value:"double_opt_in",title:l("Double Opt-in","bit-integrations"),subTitle:l("Enable Double Option for new contacts","bit-integrations")})]})}function K({i:c,formFields:r,field:e,fluentCrmConf:a,setFluentCrmConf:n}){var u;const b=e.required,i=(a==null?void 0:a.fluentCrmFlelds)&&Object.values(a==null?void 0:a.fluentCrmFlelds).filter(s=>!s.required),h=I(H),{isPro:p}=h,j=s=>{const d=o({},a);d.field_map.splice(s,0,{}),n(d)},F=s=>{const d=o({},a);d.field_map.length>1&&d.field_map.splice(s,1),n(d)},x=(s,d)=>{const m=o({},a);m.field_map[d][s.target.name]=s.target.value,s.target.value==="custom"&&(m.field_map[d].customValue=""),n(m)};return t.jsxs("div",{className:"flx mt-2 mb-2 btcbi-field-map",children:[t.jsxs("div",{className:"flx integ-fld-wrp",children:[t.jsxs("select",{className:"btcd-paper-inp mr-2",name:"formField",value:e.formField||"",onChange:s=>x(s,c),children:[t.jsx("option",{value:"",children:l("Select Field","bit-integrations")}),t.jsx("optgroup",{label:l("Form Fields","bit-integrations"),children:r==null?void 0:r.map(s=>t.jsx("option",{value:s.name,children:s.label},`ff-rm-${s.name}`))}),t.jsx("option",{value:"custom",children:l("Custom...","bit-integrations")}),t.jsx("optgroup",{label:`${l("General Smart Codes","bit-integrations")} ${p?"":`(${l("Pro","bit-integrations")})`}`,children:p&&((u=L)==null?void 0:u.map(s=>t.jsx("option",{value:s.name,children:s.label},`ff-rm-${s.name}`)))})]}),e.formField==="custom"&&t.jsx(G,{onChange:s=>P(s,c,a,n),label:l("Custom Value","bit-integrations"),className:"mr-2",type:"text",value:e.customValue,placeholder:l("Custom Value","bit-integrations"),formFields:r}),t.jsxs("select",{className:"btcd-paper-inp",name:"fluentCRMField",value:e.fluentCRMField,onChange:s=>x(s,c),disabled:b,children:[t.jsx("option",{value:"",children:l("Select Field","bit-integrations")}),b?a.fluentCrmFlelds&&Object.values(a.fluentCrmFlelds).map(s=>t.jsx("option",{value:s.key,children:s.label},`${s.key}-1`)):i&&i.map(s=>t.jsx("option",{value:s.key,children:s.label},`${s.key}-1`))]})]}),!b&&t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:()=>j(c),className:"icn-btn sh-sm ml-2 mr-1",type:"button",children:"+"}),t.jsx("button",{onClick:()=>F(c),className:"icn-btn sh-sm ml-2",type:"button","aria-label":"btn",children:t.jsx(D,{})})]})]})}function te({formID:c,formFields:r,fluentCrmConf:e,setFluentCrmConf:a,isLoading:n,setIsLoading:b,loading:i,setLoading:h,setSnackbar:p}){const j=s=>{const d=o({},e);s?d.tags=s?s.split(","):[]:delete d.tags,a(o({},d))},F=[{value:"add-tag",label:l("Add tag to a user","bit-integrations")},{value:"remove-tag",label:l("Remove tag from a user","bit-integrations")},{value:"add-user",label:l("Add user to a list","bit-integrations")},{value:"remove-user",label:l("Remove user from a list","bit-integrations")}],x=s=>{const d=o({},e);d.list_id=s.target.value,a(o({},d))},u=s=>{const d=o({},e),{name:m,value:v}=s.target;d==null||delete d.fluentCrmList,d==null||delete d.fluentCrmTags,s.target.value!==""?(d[m]=v,U(d,a,b,p),v==="add-user"||v==="remove-user"?w(c,d,a,i,h,p):$(c,d,a,i,h,p)):delete d[m],a(d)};return t.jsxs(t.Fragment,{children:[t.jsx("br",{}),t.jsxs("div",{className:"flx",children:[t.jsx("b",{className:"wdt-200 d-in-b",children:l("Action:","bit-integrations")}),t.jsxs("select",{onChange:u,name:"actionName",value:e==null?void 0:e.actionName,className:"btcd-paper-inp w-5",children:[t.jsx("option",{value:"",children:l("Select Action","bit-integrations")}),F.map(({label:s,value:d})=>t.jsx("option",{value:d,children:s},s))]})]}),t.jsx("br",{}),(i.fluentCrmList||i.fluentCrmTags)&&t.jsx(R,{style:{display:"flex",justifyContent:"center",alignItems:"center",height:100,transform:"scale(0.7)"}}),((e==null?void 0:e.actionName)==="add-user"||(e==null?void 0:e.actionName)==="remove-user")&&(e==null?void 0:e.fluentCrmList)&&!i.fluentCrmList&&t.jsxs("div",{className:"flx",children:[t.jsx("b",{className:"wdt-200 d-in-b",children:l("Fluent CRM List:","bit-integrations")}),t.jsxs("select",{onChange:s=>x(s),name:"list_id",value:e.list_id,className:"btcd-paper-inp w-5",children:[t.jsx("option",{value:"",children:l("Select Fluent CRM list","bit-integrations")}),(e==null?void 0:e.fluentCrmList)&&Object.keys(e.fluentCrmList).map(s=>t.jsx("option",{value:e.fluentCrmList[s].id,children:e.fluentCrmList[s].title},s))]}),t.jsx("button",{onClick:()=>w(c,e,a,i,h,p),className:"icn-btn sh-sm ml-2 mr-2 tooltip",style:{"--tooltip-txt":`'${l("Refresh List, Tag & Field","bit-integrations")}'`},type:"button",disabled:n,children:"↻"})]}),(e==null?void 0:e.actionName)&&(e==null?void 0:e.actionName)!=="remove-user"&&(e==null?void 0:e.fluentCrmTags)&&!i.fluentCrmTags&&t.jsxs("div",{className:"flx mt-5",children:[t.jsx("b",{className:"wdt-200 d-in-b",children:l("Fluent CRM Tags:","bit-integrations")}),t.jsx(E,{defaultValue:e==null?void 0:e.tags,className:"btcd-paper-drpdwn w-5",options:(e==null?void 0:e.fluentCrmTags)&&Object.keys(e.fluentCrmTags).map(s=>({label:e.fluentCrmTags[s].title,value:e.fluentCrmTags[s].id.toString()})),onChange:s=>j(s)}),t.jsx("button",{onClick:()=>$(c,e,a,i,h,p),className:"icn-btn sh-sm ml-2 mr-2 tooltip",style:{"--tooltip-txt":`'${l("Refresh Tag & Field","bit-integrations")}'`},type:"button",disabled:n,children:"↻"})]}),n&&t.jsx(R,{style:{display:"flex",justifyContent:"center",alignItems:"center",height:100,transform:"scale(0.7)"}}),(e==null?void 0:e.actionName)&&!n&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"mt-4",children:t.jsx("b",{className:"wdt-100",children:l("Map Fields","bit-integrations")})}),t.jsx("div",{className:"btcd-hr mt-1"}),t.jsxs("div",{className:"flx flx-around mt-2 mb-2 btcbi-field-map-label",children:[t.jsx("div",{className:"txt-dp",children:t.jsx("b",{children:l("Form Fields","bit-integrations")})}),t.jsx("div",{className:"txt-dp",children:t.jsx("b",{children:l("Fluent CRM Fields","bit-integrations")})})]}),e.field_map.map((s,d)=>t.jsx(K,{i:d,field:s,fluentCrmConf:e,formFields:r,setFluentCrmConf:a},`fluentcrm-m-${d+9}`)),t.jsx("div",{className:"txt-center btcbi-field-map-button mt-2",style:{marginRight:85},children:t.jsx("button",{onClick:()=>B(e.field_map.length,e,a),className:"icn-btn sh-sm",type:"button",children:"+"})})]}),(e==null?void 0:e.actionName)==="add-user"&&t.jsxs(t.Fragment,{children:[t.jsx("br",{}),t.jsx("div",{className:"mt-4",children:t.jsx("b",{className:"wdt-100",children:l("Utilities","bit-integrations")})}),t.jsx("div",{className:"btcd-hr mt-1"}),t.jsx(J,{fluentCrmConf:e,setFluentCrmConf:a,setIsLoading:b,setSnackbar:p})]})]})}export{te as F,ee as c,C as h};
