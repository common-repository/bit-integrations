var S=Object.defineProperty;var g=Object.getOwnPropertySymbols;var $=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable;var v=(e,a,c)=>a in e?S(e,a,{enumerable:!0,configurable:!0,writable:!0,value:c}):e[a]=c,F=(e,a)=>{for(var c in a||(a={}))$.call(a,c)&&v(e,c,a[c]);if(g)for(var c of g(a))q.call(a,c)&&v(e,c,a[c]);return e};import{i as k,j as t,L as w}from"./main-80.js";import{j as I,_ as r,k as M,l as D,L as P,N as R}from"./bi.433.0.js";import{h as N,a as _,d as V}from"./bi.924.761.js";import{g as T,a as y}from"./bi.791.768.js";import{T as A}from"./bi.895.650.js";function U({i:e,field:a,formFields:c,moosendConf:i,setMoosendConf:b}){var x;const h=k(I),{isPro:p}=h,m=(i==null?void 0:i.moosendFields.filter(l=>l.required===!0))||[],u=(i==null?void 0:i.moosendFields.filter(l=>l.required===!1))||[];return t.jsx("div",{className:"flx mt-2 mb-2 btcbi-field-map",children:t.jsxs("div",{className:"pos-rel flx",children:[t.jsxs("div",{className:"flx integ-fld-wrp",children:[t.jsxs("select",{className:"btcd-paper-inp mr-2",name:"formFields",onChange:l=>{N(l,e,i,b)},value:a.formFields||"",children:[t.jsx("option",{value:"",children:r("Select Field")}),t.jsx("optgroup",{label:r("Form Fields","bit-integrations"),children:c==null?void 0:c.map(l=>t.jsx("option",{value:l.name,children:l.label},`ff-rm-${l.name}`))}),t.jsx("option",{value:"custom",children:r("Custom...")}),t.jsx("optgroup",{label:sprintf(r("General Smart Codes %s","bit-integrations"),p?"":`(${r("Pro","bit-integrations")})`),children:p&&((x=M)==null?void 0:x.map(l=>t.jsx("option",{value:l.name,children:l.label},`ff-rm-${l.name}`)))})]}),a.formFields==="custom"&&t.jsx(A,{onChange:l=>D(l,e,i,b),label:r("Custom Value","bit-integrations"),className:"mr-2",type:"text",value:a.customValue,placeholder:r("Custom Value","bit-integrations"),formFields:c}),t.jsxs("select",{className:"btcd-paper-inp",disabled:e<m.length,name:"moosendFormFields",onChange:l=>{N(l,e,i,b)},value:e<m.length?m[e].key||"":a.moosendFormFields||"",children:[t.jsx("option",{value:"",children:r("Select Field")}),e<m.length?t.jsx("option",{value:m[e].key,children:m[e].label},m[e].key):u.map(({key:l,label:d})=>t.jsx("option",{value:l,children:d},l))]})]}),(i==null?void 0:i.method)==="1"&&t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:()=>_(e,i,b),className:"icn-btn sh-sm ml-2 mr-1",type:"button",children:"+"}),t.jsx("button",{onClick:()=>V(e,i,b),className:"icn-btn sh-sm ml-1",type:"button","aria-label":"btn",children:t.jsx("span",{className:"btcd-icn icn-trash-2"})})]})]})})}function K({moosendConf:e,setMoosendConf:a,formFields:c,loading:i,setLoading:b}){var l;const h=k(I),{isPro:p}=h,m=[{key:"1",name:r("Subscribe","bit-integrations")},{key:"0",name:r("Unsubscribe","bit-integrations")},{key:"2",name:r("Unsubscribe from list","bit-integrations")}],u=d=>{const s=F({},e),{name:j,value:n}=d.target;switch(n!==""?s[j]=n:delete s[j],j){case"listId":if(n!==""){s.basicFields||(s.basicFields=s.moosendFields);const L=p?z(s,n):[...s.basicFields];s.moosendFields=L,s.field_map=y(s)}break;case"method":s.listId="",s.moosendFields=(s==null?void 0:s.basicFields)||s.moosendFields||[],s.field_map=y(s);break}a(F({},s))},x=`<h4>${r("Custom Field Available in Pro (v2.3.1)","bit-integrations")}</h4>
  <p>${r("With the release of version 2.3.1, Pro users can now take advantage of the custom field feature.","bit-integrations")}</p>`;return t.jsxs("div",{className:"mt-2",children:[!i.page&&t.jsxs("div",{className:"flx mt-2",children:[t.jsx("b",{className:"wdt-200 d-in-b ",children:r("Method:")}),t.jsxs("select",{onChange:u,name:"method",value:e==null?void 0:e.method,className:"btcd-paper-inp w-5 mx-0",children:[t.jsx("option",{value:"",children:r("Select Method")}),m.map(d=>t.jsx("option",{value:d.key,children:d.name},d.key))]})]}),e.method&&e.method!=="0"&&t.jsxs("div",{className:"flx mt-2",children:[t.jsx("b",{className:"wdt-200 d-in-b ",children:r("List:")}),t.jsxs("select",{onChange:u,name:"listId",value:e==null?void 0:e.listId,className:"btcd-paper-inp w-5 mx-0",children:[t.jsx("option",{value:"",children:r("Select List")}),((l=e==null?void 0:e.default)==null?void 0:l.lists)&&e.default.lists.map(d=>t.jsx("option",{value:d.ID,children:d.Name},d.ID))]}),t.jsx("button",{onClick:()=>T(e,a,i,b),className:"icn-btn sh-sm ml-2 mr-2 tooltip",style:{"--tooltip-txt":'"Refresh list"'},type:"button",disabled:i.list,children:"â†»"}),i.list&&t.jsx(P,{size:"20",clr:"#022217",className:"ml-2"})]}),(e==null?void 0:e.method)&&t.jsxs("div",{className:"mt-5",children:[t.jsx("b",{className:"wdt-100",children:r("Field Map")}),t.jsx("div",{className:"btcd-hr mt-2 mb-4"}),t.jsxs("div",{className:"flx flx-around mt-2 mb-2 btcbi-field-map-label",children:[t.jsx("div",{className:"txt-dp",children:t.jsx("b",{children:r("Form Fields")})}),t.jsx("div",{className:"txt-dp",children:t.jsx("b",{children:r("Moosend Fields")})})]}),e==null?void 0:e.field_map.map((d,s)=>t.jsx(U,{i:s,field:d,formFields:c,moosendConf:e,setMoosendConf:a},`ko-m-${s+8}`)),(e==null?void 0:e.method)==="1"&&t.jsx("div",{className:"txt-center btcbi-field-map-button mt-2",children:t.jsx("button",{onClick:()=>_(e.field_map.length,e,a),className:"icn-btn sh-sm",type:"button",children:"+"})})]}),!p&&t.jsx(R,{note:x}),i.page&&t.jsx(w,{style:{display:"flex",justifyContent:"center",alignItems:"center",height:100,transform:"scale(0.7)"}})]})}const z=(e,a)=>{var b;const c=e.default.lists.find(h=>h.ID===a),i=((b=c==null?void 0:c.CustomFieldsDefinition)==null?void 0:b.map(h=>({key:`custom_field_${h.ID}`,label:h.Name,required:h.IsRequired})))||[];return[...e.basicFields,...i]};export{K as M};
